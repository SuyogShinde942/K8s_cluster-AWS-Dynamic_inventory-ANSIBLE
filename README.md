# K8s_cluster-AWS-Dynamic_inventory-ANSIBLE
# Creating a K8s cluster with | Ansible on provisioned AWS instances | Dyanamic Inventory


## Amazon Web Service :
We can define AWS (Amazon Web Services) as a secured cloud services platform that offers compute power, database storage, content delivery, and various other functionalities. To be more specific, it is a large bundle of cloud-based services.

## Kubernetes:
Kubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications.

## Ansible :
Ansible is the simplest way to automate apps and IT infrastructure. Application Deployment + Configuration Management + Continuous Delivery.

# START
# In this article, I am going to configure a K8s Cluster on AWS, Ec-2 instances with a tool for automation called ansible. Also with a dynamic inventory.

## Why dynamic inventory?
### For example, Aws default provides a dynamic IP so, after every restart, it's assigned to a new IP, or we launch a new O.S in a region called ap-south-1 and we need to use all the container as the database from that region and suppose there are 100 servers, Instead of putting it manually in the inventory there is a python script that works as a dynamic inventory which divides the instances with tags, region, subnets, etc.

# __First, let's start with provisioning of Ec-2 instances with ansible__
### Creating an Ansible role called provision-ec2

![Screenshot (311)](https://user-images.githubusercontent.com/64534620/107312833-2ec74b80-6a46-11eb-83c9-ec1f705aa10e.png)

### In roles, Creating a var file provision-ec2/vars/main.yml

![var](https://user-images.githubusercontent.com/64534620/107312952-7057f680-6a46-11eb-8aa6-a958c657fb3d.PNG)

### In the task/main.yml we are going to launch an ec2 instance using the amazon ami image one Master and two slaves.

![awsmain](https://user-images.githubusercontent.com/64534620/107313020-97162d00-6a46-11eb-9a69-0fb79118aa8a.PNG)


## Here, the most important are tags i.e k8s_master and k8s_slave because we are gonna use them in the dynamic inventory to separate them according to their uses.
## Here the access and secret key are pre-generated by me you can create your own as per your need, they are assigned to an IAM user.

![1612791874539](https://user-images.githubusercontent.com/64534620/107313690-e90b8280-6a47-11eb-8d53-a7a622f0b7cb.png)

## __Instead of providing the aws_access_key and aws_secret_key in the playbook, we can configure the AWS CLI and the Ansible will by default use the credentials which we provide while configuring the AWS CLI.__

## __The security group which was created with all inbound and outbound traffic named k8s cluster.  It's not good for security but set for doing this project.__
![3](https://user-images.githubusercontent.com/64534620/107313205-ecead500-6a46-11eb-8b5a-673f9947cb99.png)

### According to the role, all the tasks are successful

![5](https://user-images.githubusercontent.com/64534620/107313772-15270380-6a48-11eb-8b51-54580c3bc45a.png)
![4](https://user-images.githubusercontent.com/64534620/107313832-338cff00-6a48-11eb-9221-6f73e13101e3.png)
### Now the one instance for master and two for slaves are ready to configure for the k8s cluster.

## Now let's move to the dynamic inventory part
The dynamic inventory will separate the instances according to region, tags, public and private IPs, and many more

## We used two scripts for the dynamic inventory ec2.py and ec2.ini

https://raw.githubusercontent.com/ansible/ansible/stable-1.9/plugins/inventory/ec2.py  ---- ec2.py
https://raw.githubusercontent.com/ansible/ansible/stable-1.9/plugins/inventory/ec2.ini ---- ec2.ini

## Pre-requisites for these scripts are installing boto and boto3 in the system where you are running the program.
To install boto module
> pip3 install boto

> pip3 install boto3











